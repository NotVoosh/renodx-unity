#include "../common.hlsl"

Texture2D<uint> t5 : register(t5);
Texture2D<float4> t4 : register(t4);
Texture2D<float4> t3 : register(t3);
Texture2D<float4> t2 : register(t2);
Texture2D<float4> t1 : register(t1);
Texture2D<float4> t0 : register(t0);
RWTexture2D<float4> u0 : register(u0);
RWTexture2D<float4> u1 : register(u1);
RWTexture2D<float4> u2 : register(u2);
SamplerState s0_s : register(s0);
cbuffer cb0 : register(b0){
  float4 cb0[3];
}

// Starsand Island

#define cmp -

[numthreads(8, 8, 1)]
void main(uint2 vThreadID: SV_DispatchThreadID) {
  float4 r0,r1,r2,r3,r4,r5,r6,r7,r8,r9,r10,r11,r12,r13,r14,r15,r16,r17,r18,r19,r20,r21,r22;
  uint4 bitmask, uiDest;
  float4 fDest;

  r0.xy = (uint2)vThreadID.xy;
  r0.xy = float2(0.5,0.5) + r0.xy;
  r0.zw = cb0[1].zw * r0.xy;
  r1.xy = trunc(cb0[0].xy);
  r1.zw = r1.xy * r0.zw;
  r2.xy = (int2)r1.zw;
  r2.zw = float2(0,0);
  r3.z = t3.Load(r2.xyz).x;
  r3.xy = trunc(r1.zw);
  r4.xyzw = (int4)r2.xyxy + int4(2,-2,-2,-2);
  r5.xyzw = cmp((int4)r4.zwxy >= int4(0,0,0,0));
  r1.zw = r5.yw ? r5.xz : 0;
  r5.xyzw = (int4)r4.zxyw;
  r6.xyzw = cmp(r5.xwyz < cb0[0].xyxy);
  r2.zw = r6.yw ? r6.xz : 0;
  r1.zw = (int2)r1.zw & (int2)r2.zw;
  if (r1.z != 0) {
    r6.xy = r4.zw;
    r6.zw = float2(0,0);
    r6.x = t3.Load(r6.xyz).x;
    r1.z = cmp(r3.z < r6.x);
    r6.yz = r5.xw;
    r3.w = r3.z;
    r3.xyz = r1.zzz ? r6.yzx : r3.xyw;
  }
  if (r1.w != 0) {
    r4.zw = float2(0,0);
    r5.x = t3.Load(r4.xyz).x;
    r1.z = cmp(r3.z < r5.x);
    r3.xyz = r1.zzz ? r5.yzx : r3.xyz;
  }
  r2.xyzw = (int4)r2.xyxy + int4(2,2,-2,2);
  r4.xyzw = cmp((int4)r2.zwxy >= int4(0,0,0,0));
  r1.zw = r4.yw ? r4.xz : 0;
  r4.xyzw = (int4)r2.zwxy;
  r5.xyzw = cmp(r4.xyzw < cb0[0].xyxy);
  r5.xy = r5.yw ? r5.xz : 0;
  r1.zw = r1.zw ? r5.xy : 0;
  if (r1.z != 0) {
    r5.xy = r2.zw;
    r5.zw = float2(0,0);
    r5.x = t3.Load(r5.xyz).x;
    r1.z = cmp(r3.z < r5.x);
    r5.yz = r4.xy;
    r3.xyz = r1.zzz ? r5.yzx : r3.xyz;
  }
  if (r1.w != 0) {
    r2.zw = float2(0,0);
    r1.z = t3.Load(r2.xyz).x;
    r1.z = cmp(r3.z < r1.z);
    r3.xy = r1.zz ? r4.zw : r3.xy;
  }
  r2.xy = (int2)r3.xy;
  r2.zw = float2(0,0);
  r1.zw = t4.Load(r2.xyw).xy;
  r2.x = t5.Load(r2.xyz).x;
  r2.x = cmp(0 < (int)r2.x);
  r3.w = r2.x ? 1.000000 : 0;
  r0.xy = r0.xy * cb0[1].zw + -r1.zw;
  r2.yz = cmp(r0.xy >= float2(0,0));
  r2.y = r2.z ? r2.y : 0;
  r2.zw = cmp(r0.xy < float2(1,1));
  r2.z = r2.w ? r2.z : 0;
  r2.y = r2.z ? r2.y : 0;
  if (r2.y != 0) {
    r2.yz = r0.xy * cb0[1].xy + float2(-0.5,-0.5);
    r4.xy = floor(r2.yz);
    r4.zw = (int2)r4.xy;
    r2.yz = frac(r2.yz);
    r5.xyzw = (int4)r4.zwzw + int4(-1,-1,0,-1);
    r5.xyzw = (int4)r5.xyzw;
    r5.xyzw = float4(0.5,0.5,0.5,0.5) + r5.xyzw;
    r5.xyzw = cb0[1].zwzw * r5.xyzw;
    r6.xyz = t1.SampleLevel(s0_s, r5.xy, 0).xyz;
    r5.xyz = t1.SampleLevel(s0_s, r5.zw, 0).xyz;
    r7.xyzw = (int4)r4.zwzw + int4(1,-1,2,-1);
    r7.xyzw = (int4)r7.xyzw;
    r7.xyzw = float4(0.5,0.5,0.5,0.5) + r7.xyzw;
    r7.xyzw = cb0[1].zwzw * r7.xyzw;
    r8.xyz = t1.SampleLevel(s0_s, r7.xy, 0).xyz;
    r7.xyz = t1.SampleLevel(s0_s, r7.zw, 0).xyz;
    r9.xyz = r5.xyz + r5.xyz;
    r10.xyz = r8.xyz + -r6.xyz;
    r9.xyz = r10.xyz * r2.yyy + r9.xyz;
    r10.xyz = r6.xyz + r6.xyz;
    r10.xyz = -r5.xyz * float3(5,5,5) + r10.xyz;
    r10.xyz = r8.xyz * float3(4,4,4) + r10.xyz;
    r10.xyz = r10.xyz + -r7.xyz;
    r11.xy = r2.yz * r2.yz;
    r9.xyz = r11.xxx * r10.xyz + r9.xyz;
    r5.xyz = r5.xyz * float3(3,3,3) + -r6.xyz;
    r5.xyz = -r8.xyz * float3(3,3,3) + r5.xyz;
    r5.xyz = r5.xyz + r7.xyz;
    r5.xyz = r11.xxx * r5.xyz;
    r5.xyz = r5.xyz * r2.yyy + r9.xyz;
    r6.xyz = float3(0.5,0.5,0.5) * r5.xyz;
    r7.xyzw = (int4)r4.zwzw + int4(-1,0,1,0);
    r7.xyzw = (int4)r7.xyzw;
    r7.xyzw = float4(0.5,0.5,0.5,0.5) + r7.xyzw;
    r7.xyzw = cb0[1].zwzw * r7.xyzw;
    r8.xyz = t1.SampleLevel(s0_s, r7.xy, 0).xyz;
    r4.xy = float2(0.5,0.5) + r4.xy;
    r4.xy = cb0[1].zw * r4.xy;
    r9.xyz = t1.SampleLevel(s0_s, r4.xy, 0).xyz;
    r7.xyz = t1.SampleLevel(s0_s, r7.zw, 0).xyz;
    r10.xyzw = (int4)r4.zwzw + int4(2,0,-1,1);
    r10.xyzw = (int4)r10.xyzw;
    r10.xyzw = float4(0.5,0.5,0.5,0.5) + r10.xyzw;
    r10.xyzw = cb0[1].zwzw * r10.xyzw;
    r12.xyz = t1.SampleLevel(s0_s, r10.xy, 0).xyz;
    r13.xyz = r9.xyz + r9.xyz;
    r14.xyz = -r8.xyz + r7.xyz;
    r13.xyz = r14.xyz * r2.yyy + r13.xyz;
    r14.xyz = r8.xyz + r8.xyz;
    r14.xyz = -r9.xyz * float3(5,5,5) + r14.xyz;
    r14.xyz = r7.xyz * float3(4,4,4) + r14.xyz;
    r14.xyz = r14.xyz + -r12.xyz;
    r13.xyz = r11.xxx * r14.xyz + r13.xyz;
    r8.xyz = r9.xyz * float3(3,3,3) + -r8.xyz;
    r7.xyz = -r7.xyz * float3(3,3,3) + r8.xyz;
    r7.xyz = r7.xyz + r12.xyz;
    r7.xyz = r11.xxx * r7.xyz;
    r7.xyz = r7.xyz * r2.yyy + r13.xyz;
    r8.xyz = t1.SampleLevel(s0_s, r10.zw, 0).xyz;
    r9.xyzw = (int4)r4.zwzw + int4(0,1,1,1);
    r9.xyzw = (int4)r9.xyzw;
    r9.xyzw = float4(0.5,0.5,0.5,0.5) + r9.xyzw;
    r9.xyzw = cb0[1].zwzw * r9.xyzw;
    r10.xyz = t1.SampleLevel(s0_s, r9.xy, 0).xyz;
    r9.xyz = t1.SampleLevel(s0_s, r9.zw, 0).xyz;
    r12.xyzw = (int4)r4.zwzw + int4(2,1,-1,2);
    r12.xyzw = (int4)r12.xyzw;
    r12.xyzw = float4(0.5,0.5,0.5,0.5) + r12.xyzw;
    r12.xyzw = cb0[1].zwzw * r12.xyzw;
    r13.xyz = t1.SampleLevel(s0_s, r12.xy, 0).xyz;
    r14.xyz = r10.xyz + r10.xyz;
    r15.xyz = r9.xyz + -r8.xyz;
    r14.xyz = r15.xyz * r2.yyy + r14.xyz;
    r15.xyz = r8.xyz + r8.xyz;
    r15.xyz = -r10.xyz * float3(5,5,5) + r15.xyz;
    r15.xyz = r9.xyz * float3(4,4,4) + r15.xyz;
    r15.xyz = r15.xyz + -r13.xyz;
    r14.xyz = r11.xxx * r15.xyz + r14.xyz;
    r8.xyz = r10.xyz * float3(3,3,3) + -r8.xyz;
    r8.xyz = -r9.xyz * float3(3,3,3) + r8.xyz;
    r8.xyz = r8.xyz + r13.xyz;
    r8.xyz = r11.xxx * r8.xyz;
    r8.xyz = r8.xyz * r2.yyy + r14.xyz;
    r9.xyz = t1.SampleLevel(s0_s, r12.zw, 0).xyz;
    r10.xyzw = (int4)r4.zwzw + int4(0,2,1,2);
    r10.xyzw = (int4)r10.xyzw;
    r10.xyzw = float4(0.5,0.5,0.5,0.5) + r10.xyzw;
    r10.xyzw = cb0[1].zwzw * r10.xyzw;
    r12.xyz = t1.SampleLevel(s0_s, r10.xy, 0).xyz;
    r10.xyz = t1.SampleLevel(s0_s, r10.zw, 0).xyz;
    r4.xy = (int2)r4.zw + int2(2,2);
    r4.xy = (int2)r4.xy;
    r4.xy = float2(0.5,0.5) + r4.xy;
    r4.xy = cb0[1].zw * r4.xy;
    r4.xyz = t1.SampleLevel(s0_s, r4.xy, 0).xyz;
    r13.xyz = r12.xyz + r12.xyz;
    r14.xyz = r10.xyz + -r9.xyz;
    r13.xyz = r14.xyz * r2.yyy + r13.xyz;
    r14.xyz = r9.xyz + r9.xyz;
    r14.xyz = -r12.xyz * float3(5,5,5) + r14.xyz;
    r14.xyz = r10.xyz * float3(4,4,4) + r14.xyz;
    r14.xyz = r14.xyz + -r4.xyz;
    r13.xyz = r11.xxx * r14.xyz + r13.xyz;
    r9.xyz = r12.xyz * float3(3,3,3) + -r9.xyz;
    r9.xyz = -r10.xyz * float3(3,3,3) + r9.xyz;
    r4.xyz = r9.xyz + r4.xyz;
    r4.xyz = r11.xxx * r4.xyz;
    r4.xyz = r4.xyz * r2.yyy + r13.xyz;
    r9.xyz = r8.xyz * float3(0.5,0.5,0.5) + -r6.xyz;
    r9.xyz = r9.xyz * r2.zzz + r7.xyz;
    r5.xyz = -r7.xyz * float3(2.5,2.5,2.5) + r5.xyz;
    r5.xyz = r8.xyz * float3(2,2,2) + r5.xyz;
    r5.xyz = -r4.xyz * float3(0.5,0.5,0.5) + r5.xyz;
    r5.xyz = r11.yyy * r5.xyz + r9.xyz;
    r6.xyz = r7.xyz * float3(1.5,1.5,1.5) + -r6.xyz;
    r6.xyz = -r8.xyz * float3(1.5,1.5,1.5) + r6.xyz;
    r4.xyz = r4.xyz * float3(0.5,0.5,0.5) + r6.xyz;
    r4.xyz = r11.yyy * r4.xyz;
    r2.yzw = r4.xyz * r2.zzz + r5.xyz;
    r2.yzw = float3(0.5,0.5,0.5) * r2.yzw;
    r4.x = t0.SampleLevel(s0_s, r0.xy, 0).x;
    r0.x = t1.SampleLevel(s0_s, r0.xy, 0).w;
  } else {
    r2.yzw = float3(0,0,0);
    r4.x = 0;
    r0.x = 0;
  }
  r0.y = dot(r1.zw, r1.zw);
  r0.y = sqrt(r0.y);
  r1.z = r2.x ? 0 : 1;
  r0.x = r1.z * -r0.x + 1;
  r1.z = min(r4.x, r0.x);
  r0.x = r0.x * 0.5 + 0.5;
  r0.x = min(1.99000001, r0.x);
  r1.xy = r0.zw * r1.xy + cb0[2].xy;
  r4.xy = floor(r1.xy);
  r4.zw = float2(0.5,0.5) + r4.xy;
  r1.xy = r4.zw + -r1.xy;
  r4.zw = cmp(r1.xy != float2(0,0));
  r4.zw = r4.zw ? float2(-2,-2) : float2(-1,-1);
  r4.xy = (int2)r4.xy;
  r4.xy = (int2)r4.zw + (int2)r4.xy;
  r5.xy = (int2)cb0[0].xy;
  r5.xy = (int2)r5.xy + int2(-1,-1);
  r5.zw = min((int2)r5.xy, (int2)r4.xy);
  r6.xy = max(int2(0,0), (int2)r5.zw);
  r6.zw = float2(0,0);
  r6.xyz = t2.Load(r6.xyz).xyz;
  r7.xyzw = (int4)r4.xyxy + int4(1,0,2,0);
  r7.xyzw = min((int4)r7.xyzw, (int4)r5.xyxy);
  r7.xyzw = max(int4(0,0,0,0), (int4)r7.zwxy);
  r8.xy = r7.zw;
  r8.zw = float2(0,0);
  r8.xyz = t2.Load(r8.xyz).xyz;
  r7.zw = float2(0,0);
  r7.xyz = t2.Load(r7.xyz).xyz;
  r9.xyzw = (int4)r4.xyxy + int4(3,0,0,1);
  r9.xyzw = min((int4)r9.xyzw, (int4)r5.xyxy);
  r9.xyzw = max(int4(0,0,0,0), (int4)r9.zwxy);
  r10.xy = r9.zw;
  r10.zw = float2(0,0);
  r10.xyz = t2.Load(r10.xyz).xyz;
  r9.zw = float2(0,0);
  r9.xyz = t2.Load(r9.xyz).xyz;
  r11.xyzw = (int4)r4.xyxy + int4(1,1,2,1);
  r11.xyzw = min((int4)r11.xyzw, (int4)r5.xyxy);
  r11.xyzw = max(int4(0,0,0,0), (int4)r11.zwxy);
  r12.xy = r11.zw;
  r12.zw = float2(0,0);
  r12.xyz = t2.Load(r12.xyz).xyz;
  r11.zw = float2(0,0);
  r11.xyz = t2.Load(r11.xyz).xyz;
  r13.xyzw = (int4)r4.xyxy + int4(3,1,0,2);
  r13.xyzw = min((int4)r13.xyzw, (int4)r5.xyxy);
  r13.xyzw = max(int4(0,0,0,0), (int4)r13.zwxy);
  r14.xy = r13.zw;
  r14.zw = float2(0,0);
  r14.xyz = t2.Load(r14.xyz).xyz;
  r13.zw = float2(0,0);
  r13.xyz = t2.Load(r13.xyz).xyz;
  r15.xyzw = (int4)r4.xyxy + int4(1,2,2,2);
  r15.xyzw = min((int4)r15.xyzw, (int4)r5.xyxy);
  r15.xyzw = max(int4(0,0,0,0), (int4)r15.zwxy);
  r16.xy = r15.zw;
  r16.zw = float2(0,0);
  r16.xyz = t2.Load(r16.xyz).xyz;
  r15.zw = float2(0,0);
  r15.xyz = t2.Load(r15.xyz).xyz;
  r17.xyzw = (int4)r4.xyxy + int4(3,2,0,3);
  r17.xyzw = min((int4)r17.xyzw, (int4)r5.xyxy);
  r17.xyzw = max(int4(0,0,0,0), (int4)r17.zwxy);
  r18.xy = r17.zw;
  r18.zw = float2(0,0);
  r18.xyz = t2.Load(r18.xyz).xyz;
  r17.zw = float2(0,0);
  r17.xyz = t2.Load(r17.xyz).xyz;
  r19.xyzw = (int4)r4.xyxy + int4(1,3,2,3);
  r19.xyzw = min((int4)r19.xyzw, (int4)r5.xyxy);
  r19.xyzw = max(int4(0,0,0,0), (int4)r19.zwxy);
  r20.xy = r19.zw;
  r20.zw = float2(0,0);
  r20.xyz = t2.Load(r20.xyz).xyz;
  r19.zw = float2(0,0);
  r19.xyz = t2.Load(r19.xyz).xyz;
  r4.xy = (int2)r4.xy + int2(3,3);
  r4.xy = min((int2)r4.xy, (int2)r5.xy);
  r5.xy = max(int2(0,0), (int2)r4.xy);
  r5.zw = float2(0,0);
  r5.xyz = t2.Load(r5.xyz).xyz;
  if(injectedData.toneMapType == 0.f){
  r6.xyz = min(float3(1,1,1), r6.xyz);
  r8.xyz = min(float3(1,1,1), r8.xyz);
  r7.xyz = min(float3(1,1,1), r7.xyz);
  r10.xyz = min(float3(1,1,1), r10.xyz);
  r9.xyz = min(float3(1,1,1), r9.xyz);
  r12.xyz = min(float3(1,1,1), r12.xyz);
  r11.xyz = min(float3(1,1,1), r11.xyz);
  r14.xyz = min(float3(1,1,1), r14.xyz);
  r13.xyz = min(float3(1,1,1), r13.xyz);
  r16.xyz = min(float3(1,1,1), r16.xyz);
  r15.xyz = min(float3(1,1,1), r15.xyz);
  r18.xyz = min(float3(1,1,1), r18.xyz);
  r17.xyz = min(float3(1,1,1), r17.xyz);
  r20.xyz = min(float3(1,1,1), r20.xyz);
  r19.xyz = min(float3(1,1,1), r19.xyz);
  r5.xyz = min(float3(1,1,1), r5.xyz);
  } else if(injectedData.toneMapType == 1.f){
    r6.xyz /= 50.f;
    r8.xyz /= 50.f;
    r7.xyz /= 50.f;
    r10.xyz /= 50.f;
    r9.xyz /= 50.f;
    r12.xyz /= 50.f;
    r11.xyz /= 50.f;
    r14.xyz /= 50.f;
    r13.xyz /= 50.f;
    r16.xyz /= 50.f;
    r15.xyz /= 50.f;
    r18.xyz /= 50.f;
    r17.xyz /= 50.f;
    r20.xyz /= 50.f;
    r19.xyz /= 50.f;
    r5.xyz /= 50.f;
  } else {
    r6.xyz /= (injectedData.toneMapPeakNits / injectedData.toneMapGameNits);
    r8.xyz /= (injectedData.toneMapPeakNits / injectedData.toneMapGameNits);
    r7.xyz /= (injectedData.toneMapPeakNits / injectedData.toneMapGameNits);
    r10.xyz /= (injectedData.toneMapPeakNits / injectedData.toneMapGameNits);
    r9.xyz /= (injectedData.toneMapPeakNits / injectedData.toneMapGameNits);
    r12.xyz /= (injectedData.toneMapPeakNits / injectedData.toneMapGameNits);
    r11.xyz /= (injectedData.toneMapPeakNits / injectedData.toneMapGameNits);
    r14.xyz /= (injectedData.toneMapPeakNits / injectedData.toneMapGameNits);
    r13.xyz /= (injectedData.toneMapPeakNits / injectedData.toneMapGameNits);
    r16.xyz /= (injectedData.toneMapPeakNits / injectedData.toneMapGameNits);
    r15.xyz /= (injectedData.toneMapPeakNits / injectedData.toneMapGameNits);
    r18.xyz /= (injectedData.toneMapPeakNits / injectedData.toneMapGameNits);
    r17.xyz /= (injectedData.toneMapPeakNits / injectedData.toneMapGameNits);
    r20.xyz /= (injectedData.toneMapPeakNits / injectedData.toneMapGameNits);
    r19.xyz /= (injectedData.toneMapPeakNits / injectedData.toneMapGameNits);
    r5.xyz /= (injectedData.toneMapPeakNits / injectedData.toneMapGameNits);
  }
  r4.xy = (int2)r4.zw;
  r1.xy = r4.xy + r1.xy;
  r4.xy = r1.xy * r0.xx;
  r1.w = dot(r4.xy, r4.xy);
  r1.w = min(4, r1.w);
  r4.xy = r1.ww * float2(0.4,0.25) + float2(-1,-1);
  r4.xy = r4.xy * r4.xy;
  r1.w = r4.x * 1.5625 + -0.5625;
  r2.x = r1.w * r4.y;
  r21.xyzw = float4(1,0,2,0) + r1.xyxy;
  r21.xyzw = r21.xyzw * r0.xxxx;
  r4.x = dot(r21.xy, r21.xy);
  r4.x = min(4, r4.x);
  r4.xz = r4.xx * float2(0.4,0.25) + float2(-1,-1);
  r4.xz = r4.xz * r4.xz;
  r4.x = r4.x * 1.5625 + -0.5625;
  r4.x = r4.x * r4.z;
  r22.xyz = r4.xxx * r8.xyz;
  r22.xyz = r2.xxx * r6.xyz + r22.xyz;
  r1.w = r1.w * r4.y + r4.x;
  r4.xyz = min(r8.xyz, r6.xyz);
  r6.xyz = max(r8.xyz, r6.xyz);
  r2.x = dot(r21.zw, r21.zw);
  r2.x = min(4, r2.x);
  r8.xy = r2.xx * float2(0.4,0.25) + float2(-1,-1);
  r8.xy = r8.xy * r8.xy;
  r2.x = r8.x * 1.5625 + -0.5625;
  r4.w = r2.x * r8.y;
  r8.xzw = r4.www * r7.xyz + r22.xyz;
  r1.w = r2.x * r8.y + r1.w;
  r4.xyz = min(r4.xyz, r7.xyz);
  r6.xyz = max(r6.xyz, r7.xyz);
  r7.xyzw = float4(3,0,0,1) + r1.xyxy;
  r7.xyzw = r7.xyzw * r0.xxxx;
  r2.x = dot(r7.xy, r7.xy);
  r2.x = min(4, r2.x);
  r7.xy = r2.xx * float2(0.4,0.25) + float2(-1,-1);
  r7.xy = r7.xy * r7.xy;
  r2.x = r7.x * 1.5625 + -0.5625;
  r4.w = r2.x * r7.y;
  r8.xyz = r4.www * r10.xyz + r8.xzw;
  r1.w = r2.x * r7.y + r1.w;
  r4.xyz = min(r4.xyz, r10.xyz);
  r6.xyz = max(r6.xyz, r10.xyz);
  r2.x = dot(r7.zw, r7.zw);
  r2.x = min(4, r2.x);
  r7.xy = r2.xx * float2(0.4,0.25) + float2(-1,-1);
  r7.xy = r7.xy * r7.xy;
  r2.x = r7.x * 1.5625 + -0.5625;
  r4.w = r2.x * r7.y;
  r7.xzw = r4.www * r9.xyz + r8.xyz;
  r1.w = r2.x * r7.y + r1.w;
  r4.xyz = min(r4.xyz, r9.xyz);
  r6.xyz = max(r6.xyz, r9.xyz);
  r8.xyzw = float4(1,1,2,1) + r1.xyxy;
  r8.xyzw = r8.xyzw * r0.xxxx;
  r2.x = dot(r8.xy, r8.xy);
  r2.x = min(4, r2.x);
  r8.xy = r2.xx * float2(0.4,0.25) + float2(-1,-1);
  r8.xy = r8.xy * r8.xy;
  r2.x = r8.x * 1.5625 + -0.5625;
  r4.w = r2.x * r8.y;
  r7.xyz = r4.www * r12.xyz + r7.xzw;
  r1.w = r2.x * r8.y + r1.w;
  r4.xyz = min(r4.xyz, r12.xyz);
  r6.xyz = max(r6.xyz, r12.xyz);
  r2.x = dot(r8.zw, r8.zw);
  r2.x = min(4, r2.x);
  r8.xy = r2.xx * float2(0.4,0.25) + float2(-1,-1);
  r8.xy = r8.xy * r8.xy;
  r2.x = r8.x * 1.5625 + -0.5625;
  r4.w = r2.x * r8.y;
  r7.xyz = r4.www * r11.xyz + r7.xyz;
  r1.w = r2.x * r8.y + r1.w;
  r4.xyz = min(r4.xyz, r11.xyz);
  r6.xyz = max(r6.xyz, r11.xyz);
  r8.xyzw = float4(3,1,0,2) + r1.xyxy;
  r8.xyzw = r8.xyzw * r0.xxxx;
  r2.x = dot(r8.xy, r8.xy);
  r2.x = min(4, r2.x);
  r8.xy = r2.xx * float2(0.4,0.25) + float2(-1,-1);
  r8.xy = r8.xy * r8.xy;
  r2.x = r8.x * 1.5625 + -0.5625;
  r4.w = r2.x * r8.y;
  r7.xyz = r4.www * r14.xyz + r7.xyz;
  r1.w = r2.x * r8.y + r1.w;
  r4.xyz = min(r4.xyz, r14.xyz);
  r6.xyz = max(r6.xyz, r14.xyz);
  r2.x = dot(r8.zw, r8.zw);
  r2.x = min(4, r2.x);
  r8.xy = r2.xx * float2(0.4,0.25) + float2(-1,-1);
  r8.xy = r8.xy * r8.xy;
  r2.x = r8.x * 1.5625 + -0.5625;
  r4.w = r2.x * r8.y;
  r7.xyz = r4.www * r13.xyz + r7.xyz;
  r1.w = r2.x * r8.y + r1.w;
  r4.xyz = min(r4.xyz, r13.xyz);
  r6.xyz = max(r6.xyz, r13.xyz);
  r8.xyzw = float4(1,2,2,2) + r1.xyxy;
  r8.xyzw = r8.xyzw * r0.xxxx;
  r2.x = dot(r8.xy, r8.xy);
  r2.x = min(4, r2.x);
  r8.xy = r2.xx * float2(0.4,0.25) + float2(-1,-1);
  r8.xy = r8.xy * r8.xy;
  r2.x = r8.x * 1.5625 + -0.5625;
  r4.w = r2.x * r8.y;
  r7.xyz = r4.www * r16.xyz + r7.xyz;
  r1.w = r2.x * r8.y + r1.w;
  r4.xyz = min(r4.xyz, r16.xyz);
  r6.xyz = max(r6.xyz, r16.xyz);
  r2.x = dot(r8.zw, r8.zw);
  r2.x = min(4, r2.x);
  r8.xy = r2.xx * float2(0.4,0.25) + float2(-1,-1);
  r8.xy = r8.xy * r8.xy;
  r2.x = r8.x * 1.5625 + -0.5625;
  r4.w = r2.x * r8.y;
  r7.xyz = r4.www * r15.xyz + r7.xyz;
  r1.w = r2.x * r8.y + r1.w;
  r4.xyz = min(r4.xyz, r15.xyz);
  r6.xyz = max(r6.xyz, r15.xyz);
  r8.xyzw = float4(3,2,0,3) + r1.xyxy;
  r8.xyzw = r8.xyzw * r0.xxxx;
  r2.x = dot(r8.xy, r8.xy);
  r2.x = min(4, r2.x);
  r8.xy = r2.xx * float2(0.4,0.25) + float2(-1,-1);
  r8.xy = r8.xy * r8.xy;
  r2.x = r8.x * 1.5625 + -0.5625;
  r4.w = r2.x * r8.y;
  r7.xyz = r4.www * r18.xyz + r7.xyz;
  r1.w = r2.x * r8.y + r1.w;
  r4.xyz = min(r4.xyz, r18.xyz);
  r6.xyz = max(r6.xyz, r18.xyz);
  r2.x = dot(r8.zw, r8.zw);
  r2.x = min(4, r2.x);
  r8.xy = r2.xx * float2(0.4,0.25) + float2(-1,-1);
  r8.xy = r8.xy * r8.xy;
  r2.x = r8.x * 1.5625 + -0.5625;
  r4.w = r2.x * r8.y;
  r7.xyz = r4.www * r17.xyz + r7.xyz;
  r1.w = r2.x * r8.y + r1.w;
  r4.xyz = min(r4.xyz, r17.xyz);
  r6.xyz = max(r6.xyz, r17.xyz);
  r8.xyzw = float4(1,3,2,3) + r1.xyxy;
  r8.xyzw = r8.xyzw * r0.xxxx;
  r2.x = dot(r8.xy, r8.xy);
  r2.x = min(4, r2.x);
  r8.xy = r2.xx * float2(0.4,0.25) + float2(-1,-1);
  r8.xy = r8.xy * r8.xy;
  r2.x = r8.x * 1.5625 + -0.5625;
  r4.w = r2.x * r8.y;
  r7.xyz = r4.www * r20.xyz + r7.xyz;
  r1.w = r2.x * r8.y + r1.w;
  r4.xyz = min(r4.xyz, r20.xyz);
  r6.xyz = max(r6.xyz, r20.xyz);
  r2.x = dot(r8.zw, r8.zw);
  r2.x = min(4, r2.x);
  r8.xy = r2.xx * float2(0.4,0.25) + float2(-1,-1);
  r8.xy = r8.xy * r8.xy;
  r2.x = r8.x * 1.5625 + -0.5625;
  r4.w = r2.x * r8.y;
  r7.xyz = r4.www * r19.xyz + r7.xyz;
  r1.w = r2.x * r8.y + r1.w;
  r4.xyz = min(r4.xyz, r19.xyz);
  r6.xyz = max(r6.xyz, r19.xyz);
  r1.xy = float2(3,3) + r1.xy;
  r1.xy = r1.xy * r0.xx;
  r0.x = dot(r1.xy, r1.xy);
  r0.x = min(4, r0.x);
  r1.xy = r0.xx * float2(0.4,0.25) + float2(-1,-1);
  r1.xy = r1.xy * r1.xy;
  r0.x = r1.x * 1.5625 + -0.5625;
  r1.x = r0.x * r1.y;
  r7.xyz = r1.xxx * r5.xyz + r7.xyz;
  r0.x = r0.x * r1.y + r1.w;
  r1.xyw = min(r4.xyz, r5.xyz);
  r4.xyz = max(r6.xyz, r5.xyz);
  r0.x = max(0, r0.x);
  r4.w = r0.x > 0.001 ? r0.x : 1;
  r5.xyz = r7.xyz / r4.www;
  r2.x = r0.x > 0.001 ? 1.000000 : 0;
  r0.x = r2.x * r0.x;
  r1.xyw = max(r5.xyz, r1.xyw);
  r1.xyw = min(r1.xyw, r4.xyz);
  if(injectedData.toneMapType == 1.f){
    r1.xyw *= 50.f;
  } else if(injectedData.toneMapType >= 2.f){
    r1.xyw *= (injectedData.toneMapPeakNits / injectedData.toneMapGameNits);
  }
  if (r1.z > 0) {
    r0.zw = cb0[2].xy * cb0[0].zw + r0.zw;
    r4.xy = -cb0[0].zw * float2(0.5,0.5) + r0.zw;
    r4.xyz = t2.SampleLevel(s0_s, r4.xy, 0).xyz;
    if(injectedData.toneMapType == 0.f){
    r4.xyz = saturate(r4.xyz);
    }
    r0.zw = cb0[0].zw * float2(0.5,0.5) + r0.zw;
    r5.xyz = t2.SampleLevel(s0_s, r0.zw, 0).xyz;
    if(injectedData.toneMapType == 0.f){
    r5.xyz = saturate(r5.xyz);
    }
    r6.xyz = r5.xyz + r4.xyz;
    r6.xyz = r6.xyz * float3(4,4,4) + -r1.xyw;
    r6.xyz = r6.xyz * float3(0.142857149,0.142857149,0.142857149) + -r1.xyw;
    r0.z = dot(r6.xyz, float3(0.212599993,0.715200007,0.0722000003));
    r0.w = 100 * r0.y;
    r0.w = min(1, r0.w);
    r2.x = 1 + -r0.w;
    r2.x = r2.x + r2.x;
    r0.w = r0.w * 0.100000001 + r2.x;
    r6.xyz = min(r5.xyz, r4.xyz);
    r6.xyz = -abs(r0.zzz) * r0.www + r6.xyz;
    r4.xyz = max(r5.xyz, r4.xyz);
    r4.xyz = abs(r0.zzz) * r0.www + r4.xyz;
    r5.xyz = max(r6.xyz, r2.yzw);
    r2.yzw = min(r5.xyz, r4.xyz);
  }
  r0.z = r1.z * 12 + r0.x;
  r1.xyz = -r2.yzw + r1.xyw;
  r0.x = r0.x / r0.z;
  r3.xyz = r1.xyz * r0.xxx + r2.yzw;
  if(injectedData.toneMapType == 0.f){
    r3.xyz = saturate(r3.xyz);
  }
  r0.x = 5000 * r0.y;
  r0.x = min(1, r0.x);
  r0.x = r0.x * -10 + 12;
  r0.y = max(0, r0.z);
  r0.x = min(r0.y, r0.x);
  r0.x = 0.0833333358 * r0.x;
  u0[vThreadID] = r0.x;
  u1[vThreadID] = r3;
  r3.w = 0;
  if (injectedData.countOld == injectedData.countNew) {
    r3.xyz = PostToneMapScale(r3.xyz);
  }
  r3.xyz = renodx::color::srgb::EncodeSafe(r3.xyz);
  u2[vThreadID] = r3;
  return;
}